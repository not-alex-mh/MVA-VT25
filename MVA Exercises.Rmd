---
title: "MVA"
author: "Alexander M Holmsk√§r"
date: "2025-05-01"
output:
  pdf_document: default
# Study track: anything Tove Lo
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Not possible to render due to package changes as of 2026-02-15.

References to pages refer to the 2013 sixth edition, international version of Johnson and Wichern.

```{r}
library(MVN)
```


# 1.3, 1.6(b), 1.14, 1.15, 1.16, 1.17, 1.18

# 2.3, 2.5, 2.7, 2.8, 2.9, 2.21(2,b), 2.23, 2.24-2.27, 2.30, 2.31, 2.41-2.42

# 4.1, 4.2(a, c), 4.3-4.6, 4.14, 4.16-4.18, 4.26, 4.31-4.38


# Chapter 5

## 5.1
### a)

Use equation 5-7 on page 212
$$
T^2 = n(\bar{\mathbf{x}} - \boldsymbol{\mu}_0)^{\top}\mathbf{S}^{-1}(\bar{\mathbf{x}} - \boldsymbol{\mu}_0) \sim \frac{p(n-1)}{n-p}F_{{p,\ n-p}}
$$

```{r}
alpha <- .05
n <- 4
p <- 2
X <- matrix(c(2, 8, 6, 8, 12, 9, 9, 10), ncol = 2)
X
mu_mat <- matrix(c(7, 11), nrow = 2)
Xbar_mu <- colMeans(X) - mu_mat
Xbar_mu
T2 <- n*t(Xbar_mu) %*% solve(cov(X)) %*% Xbar_mu
T2
```
### b) & c)

Not significant since $13.636 < 57$.
```{r}
frac <- (n-1)*p / (n-p)
fcrit <- qf(p = 0.05, df1 = p, df2 = n-p, lower.tail = FALSE)
T2crit <- frac * fcrit
T2crit
```

## 5.4 

```{r}
t5.1 <- read.csv("https://sites.ualberta.ca/~dwiens/stat575/datasets/T5-1.DAT",
                  sep = "", header = FALSE)
```

### a)

$$
T^2 = n(\bar{\mathbf{x}} - \boldsymbol{\mu}_0)^{\top}\mathbf{S}^{-1}(\bar{\mathbf{x}} - \boldsymbol{\mu}_0) \leq c^2
$$
Direction and length are given by
$$
\sqrt{\lambda_i} \frac{c}{\sqrt{n}} = \sqrt{\lambda_i} \sqrt{\frac{p(n-1)}{n(n-p)}F_{{p,n-p}} (\alpha)}
$$

```{r}
n <- nrow(t5.1)
p <- 3
S <- cov(t5.1)
S_inv <- solve(S)
S_eigen <- eigen(S_inv)
lambdas <- S_eigen$values
c2 <- p*(n-1) / (n-p) * qf(p = 0.10, df1 = p, df2 = n-p, lower.tail = FALSE)
lengths <- sqrt(lambdas) * sqrt(c2)/sqrt(n)
lengths
```

## b)

Yes, it looks MVN.
```{r}
qqnorm(t5.1$V1)
qqline(t5.1$V1)

qqnorm(t5.1$V2)
qqline(t5.1$V2)

qqnorm(t5.1$V3)
qqline(t5.1$V3)

plot(t5.1$V1, t5.1$V2)
plot(t5.1$V1, t5.1$V3)
plot(t5.1$V2, t5.1$V3)
# library(MVN)

# Some absolute asshole decided to add check marks in the mvn() function
# Now it won't knit and I am too tired to debug.
#mvn(t5.1, mvn_test = "mardia")
```


## 5.5

Note that $\mathbf{S}^{-1}$ differs if calculated by hand, probably due to rounding in the book. Use equation 5-7 again.
$$
T^2 = n(\bar{\mathbf{x}} - \boldsymbol{\mu}_0)^{\top}\mathbf{S}^{-1}(\bar{\mathbf{x}} - \boldsymbol{\mu}_0) \sim \frac{p(n-1)}{n-p}F_{{p,n-p}}
$$
We do not reject. Looking at Figure 5.1 on page 223 of the pdf, we clearly see that $\hat{\mathbf{x}}$ lies inside of the ellipse.

```{r}
n <- 42
p <- 2
xbar <- matrix(c(.564, .603), ncol=1)
S <- matrix(c(.0144, .0117, .0117, .0146), byrow=T, nrow =2)
S_inv <- matrix(c(203.018, -163.391, -163.391, 200.228), byrow=T, nrow=2)
mu <- matrix(c(.55, .60))
T2 <- n*t(xbar - mu) %*% S_inv %*% (xbar - mu)
T2
frac <- p*(n-1) / (n-p)
fcrit <- qf(p = .05, df1 = p, df2 = n-p, lower.tail = FALSE)
T2crit <- frac* fcrit
T2crit
```

## 5.7 

Note that since we are not using linear combinations of $\mathbf{x}$ we don't need to use **a**. We can go straight to equations 5-24 on page 225.
$$
\bar{x} \pm \sqrt{\frac{p(n-1)}{n-p}F_{{p,n-p}}(\alpha)} \sqrt{\frac{s_{11}}{n}}
$$

```{r}
n <- nrow(t5.1)
p <- ncol(t5.1)
a <- matrix(c(1, 0, 0,
              0, 1, 0,
              0, 0, 1), ncol =3)
#a <- matrix(c(1, 1, 1))
xbar <- matrix(colMeans(t5.1))
S <- cov(t5.1)
frac <- p*(n-1) / (n*(n-p)) # Don't forget this parenthesis
fcrit <- qf(p = .05, df1 = p, df2 = n-p, lower.tail = FALSE)
simT_lower <- xbar - sqrt(frac * fcrit) * matrix(diag(expm::sqrtm(S))) 
simT_upper <- xbar + sqrt(frac * fcrit) * matrix(diag(expm::sqrtm(S))) 
cbind(simT_lower, simT_upper)
```
Function, for **fun**.
```{r}
T_2 <- function(data, alpha) {
  data <- as.matrix(data)
  n <- nrow(data)
  p <- ncol(data)
  constant <- sqrt((p * (n - 1)) / (n - p))
  print(constant)
  f_crit <- sqrt(qf(p = alpha, df1 = p, df2 = n-p, lower.tail = FALSE))
  
  cov_matrix <- cov(data)
  
  error_term <- diag(expm::sqrtm(cov_matrix/n))
  out <- matrix(0, nrow = p, ncol = 2)
  rownames(out) <- colnames(data)
  
  for (i in 1:p) {
    
    x_bar <- mean(data[, i])
    CI_lower <- x_bar - constant * f_crit * error_term[i]
    CI_upper <- x_bar + constant * f_crit * error_term[i]
    
    out[i, ] <- c(CI_lower, CI_upper)
  }
  return(out)
}
T_2(data = t5.1, alpha = 0.05)
```

Bonferroni CI, 5-29 page 232
$$
\bar{x}_1 \pm t_{n-1} \left( \frac{\alpha}{2p} \right) \sqrt{\frac{s_{11}}{n}}
$$
```{r}
xbar <- colMeans(t5.1)
tcrit <- qt(p = 0.05 / (2*p), df = n-1, lower.tail = FALSE)
bonferroni_lower <- xbar - tcrit * matrix(diag(expm::sqrtm(S/n)))
bonferroni_upper <- xbar + tcrit * matrix(diag(expm::sqrtm(S/n)))
cbind(bonferroni_lower, bonferroni_upper)
```

Function, for *fun*. (only works on matrices)
```{r}
bonferroni_CI <- function(data, alpha) {
  data <- as.matrix(data)
  n <- nrow(data)
  p <- ncol(data)
  CI <- matrix(0, nrow = p, ncol = 2)
  alpha_value <- alpha / (2 * p)
  t_crit <- qt(p = alpha_value, df = (n - 1), lower.tail = FALSE)
  
  cov_matrix <- cov(data)
  error_term <- sqrt(cov_matrix/n)
  x_bar <- colMeans(data)
  
  for (i in 1:p) {
    
    lower_CI <- x_bar[i] - t_crit * error_term[i, i]
    upper_CI <- x_bar[i] + t_crit * error_term[i, i]
    
    CI[i, ] <- c(lower_CI, upper_CI)
    rownames(CI) <- colnames(data)
  }
  return(CI)
}

```

## 5.9

### a)

For large samples, $T^2$ approximates the $\chi^2(p)$-distribution. See Result 5.5 on page 235.
$$
T^2 = n(\bar{\mathbf{x}} - \boldsymbol{\mu}_0)^{\top}\mathbf{S}^{-1}(\bar{\mathbf{x}} - \boldsymbol{\mu}_0) \sim \chi^2_p (\alpha)
$$

$$
\bar{x}_1 \pm \sqrt{\chi^2_p (\alpha)} \sqrt{\frac{s_{11}}{n}}
$$

```{r}
xbar <- matrix(c(95.52, 164.38, 55.69, 93.39, 17.98, 31.13))
S <- matrix(c(3266.46, 1343.97, 731.54, 1175.50, 162.68, 238.37,
              1343.97, 721.91, 324.25, 537.35, 80.17, 117.73,
              731.54, 324.25, 179.28, 281.17, 39.15, 56.80,
              1175.50, 537.35, 281.17, 474.98, 63.73, 94.85, 
              162.68, 80.17, 39.15, 63.73, 9.95, 13.88,
              238.37, 117.73, 56.80, 94.85, 13.88, 21.26), byrow = TRUE, nrow = 6)
n <- 61
p <- 6
chicrit <- qchisq(p = 0.05, df = p, lower.tail = FALSE)
simT_lower <- xbar - sqrt(chicrit) * matrix(diag(sqrt(S / n))) 
simT_upper <- xbar + sqrt(chicrit) * matrix(diag(sqrt(S / n))) 
simT_CI_L <- cbind(simT_lower, simT_upper)
rownames(simT_CI_L) <- c("Weight", "Body length", "Neck", "Girth", "Head length", "Head width")
simT_CI_L
constant <- p*(n-1) / (n-p)
fcrit <- qf(p = .05, df1 = p, df2 = n-p, lower.tail = FALSE)
simT_lower <- xbar - sqrt(constant*fcrit) * matrix(diag(sqrt(S / n))) 
simT_upper <- xbar + sqrt(constant*fcrit) * matrix(diag(sqrt(S / n))) 
simT_CI_S <- cbind(simT_lower, simT_upper)
rownames(simT_CI_S) <- c("Weight", "Body length", "Neck", "Girth", "Head length", "Head width")
simT_CI_S
```

### b)

Use the formula at the bottom of page 235.
$$
n(\bar{\mathbf{x}} - \boldsymbol{\mu}_o)^{\top} \mathbf{S}^{-1} (\bar{\mathbf{x}} - \boldsymbol{\mu}_o) \leq \chi^2_p(\alpha)
$$

```{r}
n <- 61
p <- 2
xbar <- matrix(c(95.52, 93.39))
S <- matrix(c(3266.46, 1175.50, 
              1175.50, 447.98), byrow=TRUE, ncol=2)
S_inv <- solve(S)
eigens <- eigen(S)
lambdas <- eigens$values
chicrit <- qchisq(p = 0.05, df = p, lower.tail = FALSE)

xbar - sqrt(lambdas[1]) * sqrt(chicrit /n) * eigens$vectors[,1]
xbar + sqrt(lambdas[1]) * sqrt(chicrit /n) * eigens$vectors[,1]

xbar - sqrt(lambdas[2]) * sqrt(chicrit /n) * eigens$vectors[,2]
xbar + sqrt(lambdas[2]) * sqrt(chicrit /n) * eigens$vectors[,2]

```
```{r}
plot(ellipse::ellipse((S/n),  
                      centre = xbar, 
                      #level = 0.95,
                      t = sqrt(constant*fcrit),
                      npoints = n),
     type = "l", xlim = c(60, 130))
points(xbar[1],xbar[2], col = "red" , pch = 19)
```


### c)

Bonferroni CI, 5-29 page 232
$$
\bar{x}_1 \pm t_{n-1} \left( \frac{\alpha}{2p} \right) \sqrt{\frac{s_{11}}{n}}
$$

Still can't replicate the (old) solutions manual. As before, mail me.

```{r}
xbar <- matrix(c(95.52, 164.38, 55.69, 93.39, 17.98, 31.13))
S <- matrix(c(3266.46, 1343.97, 731.54, 1175.50, 162.68, 238.37,
              1343.97, 721.91, 324.25, 537.35, 80.17, 117.73,
              731.54, 324.25, 179.28, 281.17, 39.15, 56.80,
              1175.50, 537.35, 281.17, 474.98, 63.73, 94.85, 
              162.68, 80.17, 39.15, 63.73, 9.95, 13.88,
              238.37, 117.73, 56.80, 94.85, 13.88, 21.26), byrow = TRUE, nrow = 6)
n <- 61
p <- 6
tcrit <- qt(p = 0.05 / (2*p), df = n-1, lower.tail = FALSE)
bonferroni_lower <- xbar - tcrit * matrix(diag(sqrt(S/n)))
bonferroni_upper <- xbar + tcrit * matrix(diag(sqrt(S/n)))
bonferroni_CI_all_t <- cbind(bonferroni_lower, bonferroni_upper)
rownames(bonferroni_CI_all_t) <- c("Weight", "Body length", "Neck", "Girth", "Head length", "Head width")
bonferroni_CI_all_t

zcrit <- qnorm(p = 0.05 / (2*p), lower.tail = FALSE)
bonferroni_lower <- xbar - zcrit * matrix(diag(sqrt(S/n)))
bonferroni_upper <- xbar + zcrit * matrix(diag(sqrt(S/n)))
bonferroni_CI_all_z <- cbind(bonferroni_lower, bonferroni_upper)
rownames(bonferroni_CI_all_z) <- c("Weight", "Body length", "Neck", "Girth", "Head length", "Head width")
bonferroni_CI_all_z
```

### d)

```{r}
n <- 61
p <- 6
xbar <- matrix(c(95.52, 93.39))
S <- matrix(c(3266.46, 1175.50, 
              1175.50, 447.98), byrow=TRUE, ncol=2)
tcrit <- qt(p = 0.05 / (2*p), df = n-1, lower.tail = FALSE)
bonferroni_lower <- xbar - tcrit * matrix(diag(sqrt(S/n)))
bonferroni_upper <- xbar + tcrit * matrix(diag(sqrt(S/n)))
bonferroni_CI <- cbind(bonferroni_lower, bonferroni_upper)
rownames(bonferroni_CI) <- c("Weight", "Girth")
bonferroni_CI
```
Bonferroni CI is more narrow compared to the simultaneous!
```{r}
plot(ellipse::ellipse((S/n),  
                      centre = xbar, 
                      #level = 0.95,
                      t = sqrt(constant*fcrit),
                      npoints = n),
     type = "l", xlim = c(60, 130))
points(xbar[1],xbar[2], col = "red" , pch = 19)
abline(v = bonferroni_CI_all_z[1, ], h = bonferroni_CI_all_z[4,], lty=2, col="blue")
abline(v = simT_CI_S[1, ], h = simT_CI_S[4,], lty=2, col="darkgreen")
```

### e)

We are asked to find the significance of a difference, $\bar{x}_{width} - \bar{x}_{length}$. For the variance, use 
$$
\text{Var}(Y) = \text{Var}(X_6 - X_5) = \text{Var}[X_6] + \text{Var}(X_5) - 2\text{Cov}[X_6, X_5]
$$
Follow the solutions manual and get CI intervals using *t*-critical values, and *z*-critical values, because technically we have a "large" sample.
```{r}
n <- 61
p <- 6 + 1
xbar <- matrix(c(31.12, 17.98))
yvar <- 21.26 + 9.95 - 2*13.88
tcrit <- qt(p = 0.05/(2*p), df = n-1, lower.tail = FALSE)
# Don't know why this t-crit is different than solutions manual

lower <- xbar[1] - xbar[2] - tcrit*sqrt(yvar/n)
upper <- xbar[1] - xbar[2] + tcrit*sqrt(yvar/n)

bonferroni_t_CI <- cbind(lower, upper)
bonferroni_t_CI

zcrit <- qnorm(p = 0.05/(2*p), lower.tail = FALSE)
lower <- xbar[1] - xbar[2] - zcrit*sqrt(yvar/n)
upper <- xbar[1] - xbar[2] + zcrit*sqrt(yvar/n)

bonferroni_z_CI <- cbind(lower, upper)
bonferroni_z_CI
```

## 5.10 

```{r}
t1.4 <- read.csv("https://sites.ualberta.ca/~dwiens/stat575/datasets/T1-4.DAT",
                  sep = "", header = FALSE)
colnames(t1.4) <- c("wt2", "wt3", "wt4", "wt5", "lngt2", "lngt3", "lngt4", "lngt5")
```

### a)

```{r}
t1.4.lngt <- t1.4[,5:8]
n <- nrow(t1.4)
p <- 4
xbar <- colMeans(t1.4.lngt)
S <- cov(t1.4.lngt)
constant <- p*(n-1) / (n-p)
fcrit <- qf(p = 0.05, df1 = p, df2 = n-p, lower.tail = FALSE)

lower <- xbar - sqrt(constant * fcrit) * sqrt(diag(S)) / sqrt(n)
upper <- xbar + sqrt(constant * fcrit) * sqrt(diag(S)) / sqrt(n)
T2_CI <- cbind(lower, upper)
rownames(T2_CI) <- colnames(t1.4[,5:8])
T2_CI
```

### b)

Don't know what I'm doing wrong but I am not getting the same numbers as the (old) solutions manual
```{r}
n <- nrow(t1.4)
p <- 3
xbar_diff <- -matrix(c(xbar[1] - xbar[2],
                    xbar[2] - xbar[3],
                    xbar[3] - xbar[4]))
yvar <- c(S[1,1] + S[2,2] - 2*S[1,2],
          S[2,2] + S[3,3] - 2*S[2,3],
          S[3,3] + S[4,4] - 2*S[3,4])
constant <- p*(n-1) / (n-p)
fcrit <- qf(p = 0.05, df1 = p, df2 = n-p, lower.tail = FALSE)
lower <- xbar_diff - sqrt(constant * fcrit) * sqrt(yvar)/sqrt(n)
upper <- xbar_diff + sqrt(constant * fcrit) * sqrt(yvar)/sqrt(n)
T2_CI <- cbind(lower, upper)
rownames(T2_CI) <- c("delta2-3", "delta3-4", "delta4-5")
T2_CI
```
### c)

```{r}
X_diff <- matrix(c(t1.4[,"lngt3"] - t1.4[,"lngt2"],
                   t1.4[,"lngt5"] - t1.4[,"lngt4"]), ncol = 2)
n <- nrow(X_diff)
p <- ncol(X_diff)
xbar <- colMeans(X_diff)
S <- cov(X_diff)
eigens <- eigen(S)
constant <- (p*(n-1)) / (n-p)
fcrit <- qf(p = .05, df1 = p, df2 = n-p, lower.tail = FALSE)
xbar - sqrt(eigens$values[1]) * sqrt(constant * fcrit /n) * eigens$vectors[,1]
xbar + sqrt(eigens$values[1]) * sqrt(constant * fcrit /n) * eigens$vectors[,1]

xbar - sqrt(eigens$values[2]) * sqrt(constant * fcrit /n) * eigens$vectors[,2]
xbar + sqrt(eigens$values[2]) * sqrt(constant * fcrit /n) * eigens$vectors[,2]
```

```{r}
plot(ellipse::ellipse(x = S/n,
                      centre = xbar,
                      #level = 0.95,
                      t = sqrt(constant * fcrit),
                      npoints = 100),
     type = "l")
points(xbar[1],xbar[2], col = "red" , pch = 19)
```

### d)

```{r}
n <- nrow(t1.4)
p <- 6+1
X_diff <- -matrix(c(t1.4[,"lngt2"] - t1.4[,"lngt3"],
#                    t1.4[,"lngt3"] - t1.4[,"lngt4"],
                    t1.4[,"lngt4"] - t1.4[,"lngt5"]), ncol = 2)
xbar_diff <- colMeans(X_diff)
n <- nrow(X_diff)
p <- ncol(X_diff)
xbar <- colMeans(X_diff)
S <- cov(X_diff)
S_diag <- diag(S)

tcrit <- qt(p = 0.05/ (2*p), df = n-1, lower.tail = FALSE)
lower <- xbar_diff - tcrit * sqrt(S_diag)/sqrt(n)
upper <- xbar_diff + tcrit * sqrt(S_diag)/sqrt(n)
bonferroni_CI <- cbind(lower, upper)
rownames(bonferroni_CI) <- c("delta2-3", "delta4-5")
bonferroni_CI

constant <- p*(n-1) / (n-p)
fcrit <- qf(p = .05, df1 = p, df2 = n-p, lower.tail = FALSE)
lower <- xbar_diff - sqrt(constant * fcrit / n) * sqrt(diag(S))
upper <- xbar_diff + sqrt(constant * fcrit / n) * sqrt(diag(S))
T2_CI <- cbind(lower, upper)
rownames(T2_CI) <- c("delta2-3", "delta4-5")
T2_CI
```

```{r}
plot(ellipse::ellipse(x = S/n,
                      centre = xbar,
                      #level = 0.95,
                      t = sqrt(constant * fcrit),
                      npoints = 100),
     type = "l")
points(xbar[1],xbar[2], col = "red" , pch = 19)
abline(v = bonferroni_CI[1,], h = bonferroni_CI[2,], col = "red")
abline(v = T2_CI[1,], h = T2_CI[2,], col = "blue")
```


## 5.11

```{r}
e5.11 <- data.frame(cr = c(.48, 40.53, 2.19, .55, .74, .66, .93, .37, .22),
                    st = c(12.57, 73.68, 11.13, 20.03, 20.29, .78, 4.64, .43, 1.08))
```

### a)

```{r}
n <- nrow(e5.11)
p <- 2
xbar <- colMeans(e5.11)
S <- cov(e5.11)
eigens <- eigen(S)
constant <- p*(n-1) / (n-p)
fcrit <- qf(p = .10, df1 = p, df2 = n-p, lower.tail = FALSE)
xbar - sqrt(eigens$values[1]) * sqrt(constant * fcrit / n) * eigens$vectors[,1]
xbar + sqrt(eigens$values[1]) * sqrt(constant * fcrit / n) * eigens$vectors[,1]

xbar - sqrt(eigens$values[2]) * sqrt(constant * fcrit / n) * eigens$vectors[,2]
xbar + sqrt(eigens$values[2]) * sqrt(constant * fcrit / n) * eigens$vectors[,2]
```

```{r}
plot(ellipse::ellipse(x = S/n,
                      t = sqrt(constant * fcrit),
                      centre = xbar), type= "l")
points(xbar[1], xbar[2], col = "red")
points(.30, 10)
```

### b)

Yes, see plot above
```{r}
xbar - sqrt(constant * fcrit / n) * diag(sqrt(S))
xbar + sqrt(constant * fcrit / n) * diag(sqrt(S))
```

### c)

Not normal
```{r}
Xc <- as.matrix(e5.11 - matrix(1, nrow(e5.11), 1) %*% matrix(xbar, ncol=2))
distance <- Xc %*% S %*% t(Xc)
qqnorm(diag(distance))

qqnorm(e5.11$cr)
qqnorm(e5.11$st)
```

### d)

```{r}
e5.11_v2 <- e5.11[-2,]

n <- nrow(e5.11_v2)
p <- 2
xbar <- colMeans(e5.11_v2)
S <- cov(e5.11_v2)
eigens <- eigen(S)
constant <- p*(n-1) / (n-p)
fcrit <- qf(p = .10, df1 = p, df2 = n-p, lower.tail = FALSE)
xbar - sqrt(eigens$values[1]) * sqrt(constant * fcrit / n) * eigens$vectors[,1]
xbar + sqrt(eigens$values[1]) * sqrt(constant * fcrit / n) * eigens$vectors[,1]

xbar - sqrt(eigens$values[2]) * sqrt(constant * fcrit / n) * eigens$vectors[,2]
xbar + sqrt(eigens$values[2]) * sqrt(constant * fcrit / n) * eigens$vectors[,2]
```
Still not weird point
```{r}
plot(ellipse::ellipse(x = S/n,
                      t = sqrt(constant * fcrit),
                      centre = xbar), type= "l")
points(xbar[1], xbar[2], col = "red")
points(.30, 10)

xbar - sqrt(constant * fcrit / n) * diag(sqrt(S))
xbar + sqrt(constant * fcrit / n) * diag(sqrt(S))
```
Normal!
```{r}
Xc <- as.matrix(e5.11_v2 - matrix(1, nrow(e5.11_v2), 1) %*% matrix(xbar, ncol=2))
distance <- Xc %*% S %*% t(Xc)
qqnorm(diag(distance))
```


## 5.18

```{r}
t5.2 <- read.csv("https://sites.ualberta.ca/~dwiens/stat575/datasets/T5-2.DAT",
                  sep = "", header = FALSE)
colnames(t5.2) <- c("x1", "x2", "x3")
# x1: social science and history
# x2: verbal
# x3: science
```

### a)

SUPER reject. 
```{r}
n <- nrow(t5.2)
p <- 3
xbar <- matrix(colMeans(t5.2))
mu <- matrix(c(500, 50, 30))
S <- cov(t5.2)
constant <- p*(n-1) / (n-p)
fcrit <- qf(p = 0.05, df1 = p, df2 = n-p, lower.tail = FALSE)

T2 <- n*t(xbar - mu) %*% solve(S) %*% (xbar - mu)
T2
constant*fcrit
```

### b)

```{r}
eigens <- eigen(S)
L1 <- sqrt(eigens$values[1]) * sqrt(constant * fcrit /n) 
L2 <- sqrt(eigens$values[2]) * sqrt(constant * fcrit /n)
L3 <- sqrt(eigens$values[3]) * sqrt(constant * fcrit /n) 
L1 ; L2 ; L3

eigens$vectors
```

### c)

Looks normal
```{r}
qqnorm(t5.2$x1) ; qqline(t5.2$x1)
qqnorm(t5.2$x2) ; qqline(t5.2$x2)
qqnorm(t5.2$x3) ; qqline(t5.2$x3)
```

```{r}
plot(t5.2[,1:2])
plot(t5.2[,c(1,3)])
plot(t5.2[,2:3])
```

## 5.19

```{r}
t5.11 <- read.csv("https://sites.ualberta.ca/~dwiens/stat575/datasets/T5-11.DAT",
                  sep = "", header = FALSE)
colnames(t5.11) <- c("x1", "x2")
# x1: stiffness: modulus of elasticity
# x2: bending strength
```

### a)

```{r}
n <- nrow(t5.11)
p <- 2
xbar <- colMeans(t5.11)
S <- cov(t5.11)
eigens <- eigen(S)
constant <- p*(n-1) / (n-p)
fcrit <- qf(p = .05, df1 = p, df2 = n-p, lower.tail = FALSE)
xbar - sqrt(eigens$values[1]) * sqrt(constant * fcrit / n) *eigens$vectors[,1]
xbar - sqrt(eigens$values[2]) * sqrt(constant * fcrit / n) *eigens$vectors[,2]
```

```{r}
plot(ellipse::ellipse(x = S/n,
                      centre = xbar,
                      t = sqrt(constant * fcrit)),
     type = "l")
points(xbar[1], xbar[2], col = 2, pch = 19)
points(2000, 10000, col = 2, pch = 19)
```

### b)

Look at blue dot. Is not ok. No dot, super significant
```{r}
plot(ellipse::ellipse(x = S/n,
                      centre = xbar,
                      t = sqrt(constant * fcrit)),
     type = "l", ylim = c(7400, 10100), xlim = c(1600, 2100))
points(xbar[1], xbar[2], col = "red", pch = 19)
points(2000, 10000, col = "blue", pch = 19)
```

### c)

Normal-ish, potentially some outliers.
```{r}
qqnorm(t5.11$x1) ; qqline(t5.11$x1)
qqnorm(t5.11$x2) ; qqline(t5.11$x2)
plot(t5.11)
```


## 5.20

```{r}
t5.12 <- read.csv("https://sites.ualberta.ca/~dwiens/stat575/datasets/T5-12.DAT",
                  sep = "", header = FALSE)
colnames(t5.12) <- c("x1", "x2")
# x1: tail length
# x2: wing length
```

### a)
```{r}
n <- nrow(t5.12)
p <- 2
xbar <- colMeans(t5.12)
S <- cov(t5.12)
eigens <- eigen(S)
constant <- p*(n-1) / (n-p)
fcrit <- qf(p = 0.05, df1 = p, df2 = n-p, lower.tail = FALSE)

xbar - sqrt(eigens$values[1]) * sqrt(constant * fcrit / n) * eigens$vectors[1,]
xbar - sqrt(eigens$values[2]) * sqrt(constant * fcrit / n) * eigens$vectors[2,]
```
Yes, plausible values
```{r}
plot(ellipse::ellipse(x = S/n,
                      centre = xbar,
                      t = sqrt(constant*fcrit)),
     type = "l")
points(xbar[1], xbar[2], col = "red", pch = 19)
points(190, 275, col = "blue", pch = 19)
```
$T^2 <$ critical value
```{r}
ybar <- c(190, 275)
T2 <- n*t(matrix(xbar - ybar)) %*% solve(S) %*% matrix(xbar - ybar)
T2
constant * fcrit
```

### b)

Bonferroni slightly slimmer
```{r}
lower <- xbar - sqrt(constant * fcrit / n) * sqrt(diag(S))
upper <- xbar + sqrt(constant * fcrit / n) * sqrt(diag(S))
T2_CI <- rbind(c(lower[1], upper[1]),
               c(lower[2], upper[2]))
rownames(T2_CI) <- c("x1", "x2")
colnames(T2_CI) <- c("T2 lower", "T2 upper")
tcrit <- qt(p = .05/ (2*p), df = n-1, lower.tail = FALSE)
lower <- xbar - tcrit * sqrt(diag(S / n))
upper <- xbar + tcrit * sqrt(diag(S / n))
bf_CI <- rbind(c(lower[1], upper[1]),
               c(lower[2], upper[2]))
rownames(bf_CI) <- c("x1", "x2")
colnames(bf_CI) <- c("bf lower", "bf upper")
T2_CI
bf_CI
```

### c)

Looking very normal
```{r}
qqnorm(t5.12$x1) ; qqline(t5.12$x1)
qqnorm(t5.12$x2) ; qqline(t5.12$x2)
plot(t5.12)
```


# Chapter 6

Study Track: Chappell Roan

## 6.6

```{r}
e6.6 <- data.frame(treatment = c(2, 2, 2, 3, 3, 3, 3),
                   x1 = c(3, 1, 2, 2, 5, 3, 2),
                   x2 = c(3, 6, 3, 3, 1, 1, 3))
```

### a)
Use equation 6-21 on page 285
$$
S_{pooled} = \frac{\mathbf{S}_1(n_1-1) + \mathbf{S}_2(n_2-1)}{n_1 + n_2 - 2}
$$
```{r}
n1 <- 3
n2 <- 4
S1 <- cov(e6.6[1:3, 2:3])
S2 <- cov(e6.6[4:7, 2:3])

S_pool <- (S1*(n1-1) + S2*(n2-1)) / (n1+n2-2)
S_pool
```

### b)

NOT THIS; MOVE IT
$$
T^2 = n\bar{\mathbf{D}}^{\top}\mathbf{S}^{-1}\bar{\mathbf{D}} \sim \frac{p(n-1)}{n-p}F_{p,n-p}(\alpha)
$$

Use equation 6-23 on page 285.
$$
T^2 = (\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2 -\delta_0)^{\top} \left[ \left( \frac{1}{n_1} + \frac{1}{n_2} \right) \mathbf{S}_{pooled} \right]^{-1}(\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2 -\delta_0) = c^2 \sim \frac{p(n_1 + n_2 - 2)}{(n_1 + n_2 - p -1)}F_{p,\ n1+n_2-p-1}
$$

WAY not significant.
```{r}
n1 <- 3
n2 <- 4
p <- 2
xbar1 <- c(mean(e6.6[e6.6$treatment == 2, ]$x1), mean(e6.6[e6.6$treatment == 2, ]$x2))
xbar2 <- c(mean(e6.6[e6.6$treatment == 3, ]$x1), mean(e6.6[e6.6$treatment == 3, ]$x2))
xbar_diff <- matrix(xbar1 - xbar2)
constant <- p*(n1 + n2 - 2) / (n1 + n2 - p - 1) 
fcrit <- qf(p = .01, df1 = p, df2 = n1 + n2 - p - 1, lower.tail = FALSE)
T2 <- t(xbar_diff) %*% solve((1/n1 + 1/n2) * S_pool) %*% xbar_diff 
T2
constant * fcrit
```

### c)

Use Result 6.3
$$
(\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2) \pm c \sqrt{\left( \frac{1}{n1} + \frac{1}{n_2} \right) \mathbf{S}_{pooled}}
$$
```{r}
lower <- xbar_diff[1,1] - sqrt(constant * fcrit) * sqrt((1/n1 + 1/n2) * S_pool[1,1])
upper <- xbar_diff[1,1] + sqrt(constant * fcrit) * sqrt((1/n1 + 1/n2) * S_pool[1,1])
x1_diff_T2_CI <- cbind(lower, upper)
x1_diff_T2_CI

lower <- xbar_diff[2,1] - sqrt(constant * fcrit) * sqrt((1/n1 + 1/n2) * S_pool[2,2])
uppper <- xbar_diff[2,1] + sqrt(constant * fcrit) * sqrt((1/n1 + 1/n2) * S_pool[2,2])
x1_diff_T2_CI <- cbind(lower, upper)
x1_diff_T2_CI
```
For Bonferroni CI, use the formula on page 291
$$
(\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2) \pm t_{n_1+n_2-2}\left( \frac{\alpha}{2p} \right) \sqrt{\left( \frac{1}{n1} + \frac{1}{n_2} \right) \mathbf{S}_{pooled}}
$$

```{r}
tcrit <- qt(p = .01, df = n1+n2-2, lower.tail = FALSE)
lower <- xbar_diff[1,1] - tcrit * sqrt((1/n1 + 1/n2) * S_pool[1,1])
upper <- xbar_diff[1,1] + tcrit * sqrt((1/n1 + 1/n2) * S_pool[1,1])
x1_diff_bf_CI <- cbind(lower, upper)
x1_diff_bf_CI

lower <- xbar_diff[2,1] - tcrit * sqrt((1/n1 + 1/n2) * S_pool[2,2])
uppper <- xbar_diff[2,1] + tcrit * sqrt((1/n1 + 1/n2) * S_pool[2,2])
x1_diff_bf_CI <- cbind(lower, upper)
x1_diff_bf_CI
```

## 6.7 

Assuming $\Sigma_1 = \Sigma_2$ we use the pooled variance. Then, use equation 6-23 on page 285.
$$
T^2 = (\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2 -\delta_0)^{\top} \left[ \left( \frac{1}{n_1} + \frac{1}{n_2} \right) \mathbf{S}_{pooled} \right]^{-1}(\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2 -\delta_0) = c^2 \sim \frac{p(n_1 + n_2 - 2)}{(n_1 + n_2 - p -1)}F_{p,\ n1+n_2-p-1}
$$
We reject $H_0$
```{r}
n1 <- 45
n2 <- 55
p <- 2

xbar1 <- matrix(c(204.4, 556.66))
xbar2 <- matrix(c(130, 355))

constant <- p*(n1 + n2 - 2) / (n1 + n2 - p-1)
fcrit <- qf(p = .05, df1 = p, df2 = n1 + n2 - p - 1, lower.tail = FALSE)

S1 <- matrix(c(13825.3, 23823.4,
               23823.4, 73107.4), byrow = TRUE, ncol = 2)
S2 <- matrix(c(8632.0, 19616.7,
               19616.7, 55964.5), byrow = TRUE, ncol = 2)
S_pool <- (S1*(n1-1) + S2*(n2-1)) / (n1+n2-2)

T2 <- t(xbar1 - xbar2) %*% solve((1/n1 + 1/n2)*S_pool) %*% (xbar1 - xbar2)
T2
constant*fcrit
```
To see which linear combination is most responsible for the rejection, use the Remark on the bottom of page 289.
$$
\hat\alpha \propto \mathbf{S}^{-1}_{pooled}(\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_2)
$$
We see that the difference in $x2$ is most responsible for the rejection of $H_0$.
```{r}
solve(S_pool) %*% (xbar1 - xbar2)
```

## 6.8

```{r}
e6.8 <- data.frame(treatment = c(1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 3),
                   x1 = c(6, 5, 8, 4, 7, 3, 1, 2, 2, 5, 3, 2),
                   x2 = c(7, 9, 6, 9, 9, 3, 6, 3, 3, 1, 1, 3))
```

### a)

```{r}
X1 <- matrix(c(6, 5, 8, 4, 7,
               3, 1, 2, NA, NA,
               2, 5, 3, 2, NA), byrow = TRUE, nrow = 3)
X2 <- matrix(c(7, 9, 6, 9, 9,
               3, 6, 3, NA, NA,
               3, 1, 1, 3, NA), byrow = TRUE, nrow = 3)
mean1 <- mean(X1, na.rm = TRUE)
mean1
mean2 <- mean(X2, na.rm = TRUE)
mean2
X1_mean <- matrix(c(4, 4, 4, 4, 4,
                  4, 4, 4, NA, NA,
                  4, 4, 4, 4, NA), byrow = TRUE, nrow = 3)
X2_mean <- matrix(c(5, 5, 5, 5, 5,
                  5, 5, 5, NA, NA,
                  5, 5, 5, 5, NA), byrow = TRUE, nrow = 3)
x1_t_means <- matrix(rowMeans(X1, na.rm = TRUE))
x1_t_means
x1_treatment_effect <- x1_t_means - mean1
x1_treatment_effect
X1_TE <- matrix(c(2, 2, 2, 2, 2,
                  -2, -2, -2, NA, NA,
                  -1, -1, -1, -1, NA), byrow = TRUE, nrow = 3)
x2_t_means <- matrix(rowMeans(X2, na.rm = TRUE))
x2_t_means
x2_treatment_effect <- x2_t_means - mean2
x2_treatment_effect
X2_TE <- matrix(c(3, 3, 3, 3, 3,
                  -1, -1, -1, NA, NA,
                  -3, -3, -3, -3, NA), byrow = TRUE, nrow = 3)

X1_residual <- X1 - rowMeans(X1, na.rm = TRUE)
X1_residual

X2_residual <- X2 - rowMeans(X2, na.rm = TRUE)
X2_residual

X1_SS_obs <- sum(X1[1,]^2, X1[2,]^2, X1[3,]^2, na.rm=TRUE)
X1_SS_obs
X1_SS_mean <- sum(X1_mean[1,]^2, X1_mean[2,]^2, X1_mean[3,]^2, na.rm=TRUE)
X1_SS_mean
X1_SS_treatment <- sum(X1_TE[1,]^2, X1_TE[2,]^2, X1_TE[3,]^2, na.rm=TRUE)
X1_SS_treatment 
X1_SS_res <- sum(X1_residual[1,]^2, X1_residual[2,]^2, X1_residual[3,]^2, na.rm=TRUE)
X1_SS_res

X2_SS_obs <- sum(X2[1,]^2, X2[2,]^2, X2[3,]^2, na.rm=TRUE)
X2_SS_obs
X2_SS_mean <- sum(X2_mean[1,]^2, X2_mean[2,]^2, X2_mean[3,]^2, na.rm=TRUE)
X2_SS_mean
X2_SS_treatment <- sum(X2_TE[1,]^2, X2_TE[2,]^2, X2_TE[3,]^2, na.rm=TRUE)
X2_SS_treatment 
X2_SS_res <- sum(X2_residual[1,]^2, X2_residual[2,]^2, X2_residual[3,]^2, na.rm=TRUE)
X2_SS_res

```
Cross product contributions
```{r}
# Total
CPC_total <- sum(X1 * X2, na.rm = TRUE)
CPC_total

# Mean
CPC_mean <- sum(X1_mean * X2_mean, na.rm = TRUE)
CPC_mean

# Treatment
CPC_treatment <- sum(X1_TE * X2_TE, na.rm = TRUE)
CPC_treatment

# Residual
CPC_residual <- sum(X1_residual * X2_residual, na.rm = TRUE)
CPC_residual

```

### b)

Now we construct the SSCP matrices (*Sum of Squares and Cross Producs*)
```{r}
SSCP_treatment <- matrix(c(X1_SS_treatment, CPC_treatment,
                           CPC_treatment, X2_SS_treatment), byrow = TRUE, ncol = 2)
SSCP_treatment

SSCP_residual <- matrix(c(X1_SS_res, CPC_residual,
                           CPC_residual, X2_SS_res), byrow = TRUE, ncol = 2)
SSCP_residual

SSCP_total <- matrix(c(X1_SS_obs - X1_SS_mean, CPC_total - CPC_mean,
                       CPC_total - CPC_mean, X2_SS_obs - X2_SS_mean), byrow = TRUE, ncol = 2)
SSCP_total
```

### c)
$\mathbf{B} = SSCP_{Treatment}$ and $\mathbf{W} = SSCP_{Residual}$. Use equation 6-42 on page 303.
$$
\Lambda^{\ast} = \frac{|\mathbf{W}|}{|\mathbf{B} + \mathbf{W} |} = \frac{SSCP_{Residual}}{SSCP_{Residual} + SSCP_{Treatment}} = \frac{SSCP_{Residual}}{SSCP_{Total}}
$$
Also use the distribution of Wilks' Lambda $\Lambda^{\ast}$ for 2 variables and 2 groups.
$$
\left( \frac{\sum n_i - g - 1}{g - 1} \right) \left( \frac{1-{\sqrt{\Lambda^{\ast}}}}{\sqrt{\Lambda^{\ast}}} \right) \sim F_{2(g-1),\ 2(\sum n_i - g - 1)}
$$
Super significant
```{r}
n1 <- 5
n2 <- 3
n3 <- 4
N <- n1 + n2 + n3
g <- 3
alpha <- .01

Lambda <- det(SSCP_residual) / det(SSCP_residual + SSCP_treatment)
Lambda

statistic <- (N - g - 1) / (g - 1) * (1 - sqrt(Lambda))/sqrt(Lambda) 
statistic

fcrit <- qf(p = alpha, df1 = 2*(g - 1), df2 = 2*(N - g - 1), lower.tail = FALSE)
fcrit

p_val <- pf(q = statistic, df1 = 2*(g - 1), df2 = 2*(N - g - 1), lower.tail = FALSE)
p_val
```

For the $\chi^2$-approximation with Bartlett's correction for large $n$, use equation 6-44 on page 304.
$$
- \left( n - 1 - \frac{p+g}{2} \right) \text{ln } \Lambda^{\ast} \sim \chi^2_{p(g-1)} (\alpha)
$$
Still super significant!
```{r}
p <- 2
bartlett_statistic <- -(N - 1 - (p+g)/2) * log(Lambda)
bartlett_statistic
chicrit <- qchisq(p = alpha, df = p*(g - 1), lower.tail = FALSE)
chicrit
p_val <- pchisq(q = bartlett_statistic, df = p*(g - 1), lower.tail = FALSE)
p_val
```

## 6.10 

$$
\begin{aligned}
(\bar x \mathbf{1})^{\top}[(\bar x_l - \bar x)\mathbf{u}_l + \dots + (\bar x_g - \bar x)\mathbf{u}_g] &= \bar x [(\bar x_l - \bar x)\mathbf{u}_l + \dots + (\bar x_g - \bar x)\mathbf{u}_g] \\
&= \bar x[(\bar x_l - \bar x)n_l + \dots + (\bar x_g - \bar x)n_g] \\
&= \bar x[n_l \bar x_l + \dots + n_g \bar x_g - \bar x(n_l + \dots n_g)] \\
&= \bar x[(n_l + \dots + n_g)\bar x - \bar x (n_l + \dots + n_g)] \\
&= 0
\end{aligned}
$$

## 6.12

### a)

???

### b)

Profiles are not linear.
```{r}
n1 <- 30
n2 <- 30
p <- 4
xbar1 <- matrix(c(6.4, 6.8, 7.3, 7.0))
xbar2 <- matrix(c(4.3, 4.9, 5.3, 5.1))

S_pool <- matrix(c(.61, .26, .07, .16,
                   .26, .64, .17, .14,
                   .07, .17, .81, .03,
                   .16, .14, .03, .31), byrow = TRUE, ncol = 4)
C <- matrix(c(1, -2, 1, 0, 
              0, 1, -2, 1), byrow = TRUE, nrow = 2)
T2 <- t(xbar1 + xbar2) %*% t(C) %*% 
  solve((1/n1 + 1/n2) * C %*% S_pool %*% t(C)) %*%
  C %*% (xbar1 + xbar2)
T2

constant <- (p - 2) * (n1 + n2 - 2) / (n1 + n2 - p + 1)
fcrit <- qf(p = .05, df1 = p-2, df2 = n1 + n2 - p + 1, lower.tail = FALSE)
constant * fcrit
```


## 6.13 

### a)
Decomposition for X1
```{r}
X1 <- matrix(c(6, 4, 8, 2,
               3, -3, 4, -4,
               -3, -4, 3, -4), byrow = TRUE, nrow = 3)
mean_x1 <- mean(X1)
X1_mean <- matrix(rep(mean_x1, 3*4), nrow = 3)

means_f1 <- rowMeans(X1)
f1_effect <- means_f1 - mean_x1
f1_effect
X1F1_effect <- matrix(rep(f1_effect, 4), byrow = FALSE, nrow = 3)
X1F1_effect

means_f2 <- colMeans(X1)
means_f2
f2_effect <- means_f2 - mean_x1
f2_effect
X1F2_effect <- matrix(rep(f2_effect, 3), byrow = TRUE, nrow = 3)
X1F2_effect

X1_residual <- X1 - X1_mean - X1F1_effect - X1F2_effect
X1_residual
```

Decomposition for X2
```{r}
X2 <- matrix(c(8, 6, 12, 6,
               8, 2, 3, 3,
               2, -5, -3, -6), byrow = TRUE, nrow = 3)
mean_x2 <- mean(X2)
X2_mean <- matrix(rep(mean_x2, 3*4), nrow = 3)
X2_mean

f1_means <- rowMeans(X2)
f1_means
f1_effect <- f1_means - mean_x2
f1_effect
X2F1_effect <- matrix(rep(f1_effect, 4), byrow = FALSE, nrow = 3)
X2F1_effect

f2_means <- colMeans(X2)
f2_means
f2_effect <- f2_means - mean_x2
X2F2_effect <- matrix(rep(f2_effect, 3), byrow = TRUE, nrow = 3)
X2F2_effect

X2_residual <- X2 - X2_mean - X2F1_effect - X2F2_effect
X2_residual
```

### b)

SS for X1
```{r}
X1_SS_total <- sum(X1*X1)
X1_SS_total

X1_SS_mean <- sum(X1_mean^2)
X1_SS_mean

X1_SS_F1 <- sum(X1F1_effect^2)
X1_SS_F1

X1_SS_F2 <- sum(X1F2_effect^2)
X1_SS_F2

X1_SS_residual <- sum(X1_residual^2)
X1_SS_residual
```

SS for X2
```{r}
X2_SS_total <- sum(X2^2)
X2_SS_total

X2_SS_mean <- sum(X2_mean^2)
X2_SS_mean

X2_SS_F1 <- sum(X2F1_effect^2)
X2_SS_F1

X2_SS_F2 <- sum(X2F2_effect^2)
X2_SS_F2

X2_SS_residual <- sum(X2_residual^2)
X2_SS_residual
```

Cross-product contributions
```{r}
CPC_total <- sum(X1*X2)
CPC_total

CPC_mean <- sum(X1_mean * X2_mean)
CPC_mean

CPC_F1 <- sum(X1F1_effect * X2F1_effect)
CPC_F1

CPC_F2 <- sum(X1F2_effect * X2F2_effect)
CPC_F2

CPC_residual <- sum(X1_residual * X2_residual)
CPC_residual
```
SSCP. Note that the degrees of freedom are unusual in that they assume $n =1$.
```{r}
SSCP_total <- matrix(c(X1_SS_total, CPC_total,
                       CPC_total, X2_SS_total), byrow = TRUE, nrow = 2)
SSCP_total 

SSCP_mean <- matrix(c(X1_SS_mean, CPC_mean,
                       CPC_mean, X2_SS_mean), byrow = TRUE, nrow = 2)
SSCP_mean

SSCP_F1 <- matrix(c(X1_SS_F1, CPC_F1,
                    CPC_F1, X2_SS_F1), byrow = TRUE, nrow = 2)
SSCP_F1 # df: lvls - 1 = 3 - 1 = 2

SSCP_F2 <- matrix(c(X1_SS_F2, CPC_F2,
                    CPC_F2, X2_SS_F2), byrow = TRUE, nrow = 2)
SSCP_F2 # df: lvls - 1 = 3 - 1 = 3

SSCP_residual <- matrix(c(X1_SS_residual, CPC_residual,
                          CPC_residual, X2_SS_residual), 
                        byrow = TRUE, nrow = 2)
# Usually gb(n-1) but now for some reason
SSCP_residual # df: (F1 lvls - 1) * (F2 lvls - 1) = 2 * 3 = 6

SSCP_total_corr <- SSCP_total - SSCP_mean 
SSCP_total_corr # df: (F1 lvls) * (F2 lvls) - 1 = 3 *4 - 1 = 11
```

### d)

Use

There is a main effect of factor 1 super significant, we reject $H_0 : \tau_1 = \tau_2 = \tau 3$. There is also a significant main effect of factor 2, we reject $H_0 : \beta_1 = \beta_2 = \beta_3 = \beta_4$.
```{r}
N <- n1 + n2 
p <- 2
f1_lvls <- 3
f2_lvls <- 4
df_error <- (f1_lvls - 1) * (f2_lvls - 1)
df_f1 <- f1_lvls - 1
df_f2 <- f2_lvls - 1

chicrit1 <- qchisq(p = .05, df = p*df_f1, lower.tail = FALSE)
chicrit1
Lambda_F1 <- det(SSCP_residual) / det(SSCP_F1 + SSCP_residual)
Lambda_F1
F1_statistic <- -(df_error - (p + 1 - df_f1)/2) * log(Lambda_F1)
F1_statistic
F1_p_val <- pchisq(q = F1_statistic, df = p*df_f1, lower.tail = FALSE)
F1_p_val

chicrit2 <- qchisq(p = .05, df = p*df_f2, lower.tail = FALSE)
chicrit2
Lambda_F2 <- det(SSCP_residual) / det(SSCP_F2 + SSCP_residual)
Lambda_F2
F2_statistic <- -(df_error - (p + 1 - df_f2)/2) * log(Lambda_F2)
F2_statistic
F2_p_val <- pchisq(q = F2_statistic, df = p*df_f2, lower.tail = FALSE)
F2_p_val
```



## 6.22(a,c) 

```{r}
t6.12 <- read.csv("https://sites.ualberta.ca/~dwiens/stat575/datasets/T6-12.DAT",
                  sep = "", header = FALSE)
colnames(t6.12) <- c("x1", "x2", "x3", "x4", "sex")
# x1 : resting volume O2, L/min
# x2 : resting volume O2, mL/kg/min
# x3 : maximum volume O2, L/min
# x4 : maximum volume O2, mL/kg/min
t6.12$sex <- as.factor(t6.12$sex)
```

### a)

```{r}
biotools::boxM(data = t6.12[,1:4], grouping = t6.12$sex)
MVN::mvn(t6.12[t6.12$sex == "male", 1:4], mvn_test = "mardia")
MVN::mvn(t6.12[t6.12$sex == "female", 1:4], mvn_test = "mardia")
```

```{r}
result <-Hotelling::hotelling.test(x = t6.12[t6.12$sex == "male", 1:4],
                                   y = t6.12[t6.12$sex == "female", 1:4],
                                   var.equal = FALSE)
result
```
```{r}
n1 <- nrow(t6.12[t6.12$sex == "female", 1:4])
n2 <- nrow(t6.12[t6.12$sex == "male", 1:4])
p <- 4

xbar1 <- matrix(colMeans(t6.12[t6.12$sex == "female", 1:4]))
xbar2 <- matrix(colMeans(t6.12[t6.12$sex == "male", 1:4]))
S1 <- cov(t6.12[t6.12$sex == "female", 1:4])
S2 <- cov(t6.12[t6.12$sex == "male", 1:4])
S_pool <- (S1*(n1-1) + S2*(n2-1)) / (n1+n2-2)

constant <- p*(n1+n2-2) / (n1+n2-p-1)
fcrit <- qf(p = .05, df1 = p, df2 = n1+n2-p-1, lower.tail = FALSE)

T2 <- n1*n2 / (n1+n2) * t(xbar1 - xbar2) %*% solve(S_pool) %*% (xbar1 - xbar2)
T2
constant * fcrit

# This is for large samples
t(xbar1 - xbar2) %*% solve(S1/n1 + S2/n2) %*% (xbar1 - xbar2)
qchisq(p = .05, df = 4, lower.tail = FALSE)
```

First variable is the largest offender. Why do I have the wrong numbers?
```{r}
solve(S_pool) %*% (xbar1 - xbar2)
```



### b)
Use Result 6.3 on page 288.
$$
(\bar{\mathbf{x}}_1 - \bar{\mathbf{x}}_1) \pm \sqrt{\frac{p(n_1 + n_2 - 2)}{n_1+n_2-p-1} F_{p,\ n_1+ n_2 - p -1} (\alpha) } \sqrt{\left( \frac{1}{n_1} + \frac{1}{n_2} \right) \mathbf{S}_{pooled}} 
$$

```{r}
females <- subset(t6.12, sex == "female")[,1:4]
males <- subset(t6.12, sex == "male")[,1:4]
x_diff <- as.vector(xbar1 - xbar2)
low <- x_diff[1] - sqrt(constant * fcrit) * sqrt(S_pool[1,1]) * sqrt(1/n1 + 1/n2)
up <- x_diff[1] + sqrt(constant * fcrit) * sqrt(S_pool[1,1]) * sqrt(1/n1 + 1/n2)
cbind(low, up)

low <- x_diff[2] - sqrt(constant * fcrit) * sqrt(S_pool[2,2]) * sqrt(1/n1 + 1/n2)
up <- x_diff[2] + sqrt(constant * fcrit) * sqrt(S_pool[2,2]) * sqrt(1/n1 + 1/n2)
cbind(low, up)

low <- x_diff[3] - sqrt(constant * fcrit) * sqrt(S_pool[3,3]) * sqrt(1/n1 + 1/n2)
up <- x_diff[3] + sqrt(constant * fcrit) * sqrt(S_pool[3,3]) * sqrt(1/n1 + 1/n2)
cbind(low, up)

low <- x_diff[4] - sqrt(constant * fcrit) * sqrt(S_pool[4,4]) * sqrt(1/n1 + 1/n2)
up <- x_diff[4] + sqrt(constant * fcrit) * sqrt(S_pool[4,4]) * sqrt(1/n1 + 1/n2)
cbind(low, up)
```

### c)

We cannot generalize since the measures are probably highly dependent on age.

## 6.27

```{r}
xbar1 <- matrix(c(6.833, 7.033, 3.967, 4.700)) # males
xbar2 <- matrix(c(6.633, 7.000, 4.000, 4.533)) # females
S_pool <- matrix(c(.606, .262, .066, .161,
                   .262, .637, .173, .143,
                   .066, .173, .810, .029,
                   .161, .143, .029, .306), byrow = TRUE, ncol = 4)
```

### a)

```{r}
plot(x = xbar1, type = "o", col = "blue", ylim = c(0, 50))
lines(x = xbar2, type = "o", col = "red")
```

### b)

We cannot reject $H_0$ that the lines are parallell.
```{r}
n1 <- 30
n2 <- 30
p <- 4

xbar1 <- matrix(c(6.833, 7.033, 3.967, 4.700)) # males
xbar2 <- matrix(c(6.633, 7.000, 4.000, 4.533)) # females
S_pool <- matrix(c(.606, .262, .066, .161,
                   .262, .637, .173, .143,
                   .066, .173, .810, .029,
                   .161, .143, .029, .306), byrow = TRUE, ncol = 4)

C <- matrix(c(1, -1, 0, 0,
              0, 1, -1, 0,
              0, 0, 1, -1), byrow = TRUE, ncol = 4)

constant <- (p-1) * (n1+n2-2) / (n1+n2-p)
fcrit <- qf(p = .05, df1 = p-1, df2 = n1+n2-p, lower.tail = FALSE)

T2 <- t(xbar1 - xbar2) %*% t(C) %*% solve(((n1+n3) /(n1*n2)) * C %*% S_pool %*%t(C)) %*% C %*% (xbar1 - xbar2)
T2
constant * fcrit
p_val <- pf(q = T2, df1 = p-1, df2 = n1+n2-p, lower.tail = FALSE)
p_val
```

We cannot reject that lines are coincident
```{r}
ONE <- matrix(c(1, 1, 1, 1))
T2 <- ( t(ONE) %*% (xbar1 - xbar2) / sqrt((n1+n2)/(n1*n2) * t(ONE) %*% S_pool %*% ONE) )^2
T2
fcrit <- qf(p = .05, df1 = 1, df2 = n1+n2-2, lower.tail = FALSE)
fcrit
p_val <- pf(q = T2, df1 = 1, df2 = n1+n2-2, lower.tail = FALSE)
p_val
```

SUPER not level
```{r}
xbar <- (xbar1 + xbar2)/2
T2 <- (n1+n2) * t(xbar) %*% t(C) %*% solve(C %*% S_pool %*% t(C)) %*% C %*% xbar
T2

constant <- (p-1)*(n1+n2-1) / (n1+n2-p+1) 
fcrit <- qf(p = .05, df1 = p-1, df2 = n1+n2-p+1, lower.tail = FALSE)
constant * fcrit

p_val <- pf(q = T2, df1 = p-1, df2 = n1+n2-p+1, lower.tail = FALSE)
p_val
```

## 6.31

```{r}
t6.17 <- read.csv("https://sites.ualberta.ca/~dwiens/stat575/datasets/T6-17.DAT",
                  sep = "", header = FALSE)
colnames(t6.17) <- c("f1", "f2", "x1", "x2", "x3")
t6.17$f1 <- as.factor(t6.17$f1)
t6.17$f2 <- as.factor(t6.17$f2)
# f1: Location
# f2: Variety
# x1: Yield
# x2: Weight of sound mature kernels
# x3: Seed size
```

### a)

```{r}
result <- manova(cbind(x1, x2, x3) ~ f1*f2, data = t6.17)
summary(result, test = "Wilks")
summary(result, test = "Pillai")
summary.aov(result)
```

```{r}
result_lm <- lm(cbind(x1, x2, x3) ~ f1*f2, data = t6.17)
fit_lm <- car::Anova(result_lm)
summary(fit_lm)
```

```{r}
SSCP_F1 <- fit_lm$SSP$f1
SSCP_F1

SSCP_F2 <- fit_lm$SSP$f2
SSCP_F2

SSCP_interaction <- fit_lm$SSP$`f1:f2`
SSCP_interaction

SSCP_error <- fit_lm$SSPE
SSCP_error
```
F distribution from page 322.


F1 effect
```{r}
n <- nrow(t6.17)
# Wilks' Lambda
Lambda_F1 <- det(SSCP_error) / det(SSCP_error + SSCP_F1)
df_f1 <- 1
p <- 2
# CANNOT FIND THE CORRECT DISTRIBUTION
F1_statistic <- -(6 - (p+1-df_f1)/2) * log(Lambda_F1) 
F1_statistic


# Pillai's Trace V
psych::tr(SSCP_F1 %*% solve(SSCP_F1 + SSCP_error))
```

F2 effect
```{r}
# Wilks' Lambda
Lambda_F2 <- det(SSCP_error) / det(SSCP_error + SSCP_F2)
df_f2 <- 2
p <- 2
# CANNOT FIND THE CORRECT DISTRIBUTION
F2_statistic <- -(6 - (p+1-df_f2)/2) * log(Lambda_F2) 
F2_statistic

-(n - 1 - (2+12)/2) * log(Lambda_F2)

# Pillai's Trace V
psych::tr(SSCP_F2 %*% solve(SSCP_F2 + SSCP_error))
```

Interaction effect
```{r}
# Wilks' Lambda
det(SSCP_error) / det(SSCP_error + SSCP_interaction)
# Pillai's Trace V
psych::tr(SSCP_interaction %*% solve(SSCP_interaction + SSCP_error))
```

### b)

```{r}
MVN::mvn(t6.17[,3:5], mvn_test = "mardia", univariate_test = "SW")
groups <- c(1,1,2,2,3,3,4,4,5,5,6,6)
biotools::boxM(data = t6.17[,3:5], grouping = groups)
biotools::boxM(data = t6.17[,3:5], grouping = t6.17$f1)
biotools::boxM(data = t6.17[,3:5], grouping = t6.17$f2)
md <- mahalanobis(x = t6.17[,3:5], center = colMeans(t6.17[,3:5]), cov = cov(t6.17[,3:5]))
qqnorm(md)
pchisq(q = md, df = 3-1, lower.tail = FALSE) # Obs 4 potentially an outlier
```

Check residuals
TEACHER SHOULD ONLY ACCEPT STANDARIZED RESIDUALS - TvR
```{r}
std_res <- rstandard(result)
MVN::mvn(std_res, mvn_test = "mardia", univariate_test = "SW")

result$residuals
```


### c)
```{r}
summary.aov(result)
```

```{r}
# X1
pairwise.t.test(x = t6.17$x1, g = groups , p.adj = "bonferroni") 

# X2
pairwise.t.test(x = t6.17$x2, g = groups , p.adj = "bonferroni") 

# X3
pairwise.t.test(x = t6.17$x3, g = groups , p.adj = "bonferroni") 
```

### d)

```{r}
pairwise.t.test(x = t6.17$x1, g = t6.17$f2, p.adj = "bonferroni")

pairwise.t.test(x = t6.17$x2, g = t6.17$f2, p.adj = "bonferroni")

pairwise.t.test(x = t6.17$x3, g = t6.17$f2, p.adj = "bonferroni")

```
```{r}
rstatix::pairwise_t_test(data = t6.17, formula = x1 ~ f2)
rstatix::pairwise_t_test(data = t6.17, formula = x2 ~ f2)
rstatix::pairwise_t_test(data = t6.17, formula = x3 ~ f2)
```


## 6.33

```{r}
t6.18 <- read.csv("https://sites.ualberta.ca/~dwiens/stat575/datasets/T6-18.DAT",
                  sep = "", header = FALSE)
colnames(t6.18) <- c("x1.560nm", "x2.720nm", "species", "time", "replication")
t6.18$species <- as.factor(t6.18$species)
t6.18$time <- as.factor(t6.18$time)
```

### a)

```{r}
result <- manova(cbind(x1.560nm, x2.720nm) ~ species*time, data = t6.18)
summary(result, test = "Wilks")
```

### b)
Cluster of outliers and super violated homogeneity of var-cov
```{r}
MVN::mvn(data = t6.18[,1:2], mvn_test = "mardia", univariate_test = "SW")
plot(t6.18[,1:2])

md <- mahalanobis(x = t6.18[,1:2], center = colMeans(t6.18[,1:2]), cov = cov(t6.18[,1:2]))
md_p <- pchisq(q = md, d = 2-1)
md_p[order(md_p, decreasing = FALSE)]

biotools::boxM(data = t6.18[,1:2], grouping = t6.18$species)
biotools::boxM(data = t6.18[,1:2], grouping = t6.18$time)

heplots::boxM(Y = t6.18[,1:2], group = t6.18$species)
heplots::boxM(cbind(x1.560nm, x2.720nm) ~ species*time, data = t6.18)
```

Residuals are not mvn
```{r}
std_res <- rstandard(result)
MVN::mvn(data = std_res, mvn_test = "mardia", univariate_test = "SW")
qqnorm(std_res)
hist(std_res)
```


### c)

Yep, interaction only for 560 nm
```{r}
summary.aov(result)
```

### d)

Repeated measures and growth curves

# Chapter 7

Not on the exam
7.8(a,b), 7.9, 7.10, 7.12, 7.26

# Chapter 10

2SICH - Feeling fine (no)

## 10.1

```{r}
library(expm)
S_11 <- matrix(c(100, 0, 0, 1), byrow = TRUE, nrow = 2)
S_11
S_12 <- matrix(c(0, 0, .95, 0), byrow = TRUE, nrow = 2)
S_12
S_21 <- t(S_12)
S_21
S_22 <- matrix(c(1, 0, 0, 100), byrow = TRUE, nrow = 2)
S_22

ssSss <- solve(sqrtm(S_11)) %*% S_12 %*% solve(S_22) %*% S_21 %*% solve(sqrtm(S_11))
ssSss
eigens <- eigen(ssSss)
eigens
sqrt(eigens$values[1])

```

Standardize if you want
```{r}
S = matrix(c(100, 0, 0 ,0,
             0, 1, 0.95, 0,
             0, 0.95, 1, 0,
             0, 0, 0, 100), nrow = 4, byrow = TRUE)
# Standardize using diag

D <- diag(c(.1, 1, 1, .1))
D
R <-  D %*% S %*% D
R
```

## 10.2

### a)

```{r}
mu1 <- matrix(c(-3, 2))
mu2 <- matrix(c(0, 1))
S_11 <- matrix(c(8, 2, 2, 5), byrow = TRUE, nrow = 2)
S_12 <- matrix(c(3, 1, -1, 3), byrow = TRUE, nrow = 2)
S_21 <- t(S_12)
S_22 <- matrix(c(6, -2, -2, 7), byrow = TRUE, nrow = 2)

ssSss_e <- solve(sqrtm(S_11)) %*% S_12 %*% solve(S_22) %*% S_21 %*% solve(sqrtm(S_11))
e_eigens <- eigen(ssSss_e)
rho_1 <- sqrt(e_eigens$values[1])
rho_1
rho_2 <- sqrt(e_eigens$values[2])
rho_2
```

### b)

```{r}
ssSss_f <- solve(sqrtm(S_22)) %*% S_21 %*% solve(S_11) %*% S_12 %*% solve(sqrtm(S_22))
f_eigens <- eigen(ssSss_f)

U_a1 <- t(e_eigens$vectors[,1]) %*% solve(sqrtm(S_11))
U_a1
V_a1 <- t(f_eigens$vectors[,1]) %*% solve(sqrtm(S_22))
V_a1

U_a2 <- t(e_eigens$vectors[,2]) %*% solve(sqrtm(S_11))
U_a2
V_a2 <- t(f_eigens$vectors[,2]) %*% solve(sqrtm(S_22))
V_a2
```

### c)

```{r}
E_UV <- matrix(c(U_a1 %*% mu1, U_a2 %*% mu1,
                 V_a1 %*% mu2, V_a2 %*% mu2))
E_UV

UA <- rbind(U_a1, U_a2)
UA
Var_U <- UA %*% S_11 %*% t(UA)
Var_U

VA <- rbind(V_a1, V_a2)
VA
Var_V <- VA %*% S_22 %*% t(VA)
Var_V

Cov_UV <- UA %*% S_12 %*% t(VA)
Cov_UV

```


## 10.4

No, exhausting..

## 10.7

This is even more exhausting?

### a)

### b)

## 10.12

```{r}
R_11 <- matrix(c(1, .8, .8, 1), byrow = TRUE, nrow = 2)
R_21 <- matrix(c(.26, .33, .67, .59, .34, .34), byrow = TRUE, nrow = 3)
R_12 <- t(R_21)
R_22 <- matrix(c(1, .37, .21, .37, 1, .35, .21, .35, 1), byrow = TRUE, nrow = 3)
R <- cbind(rbind(R_11, R_21), rbind(R_12, R_22))
R
```

### a)

First variable is significant
```{r}
n <- 70
p <- 2
q <- 3
rrRrr_e <- solve(sqrtm(R_11)) %*% R_12 %*% solve(R_22) %*% R_21 %*% solve(sqrtm(R_11))
eigens_e <- eigen(rrRrr_e)
rrRrr_f <- solve(sqrtm(R_22)) %*% R_21 %*% solve(R_11) %*% R_12 %*% solve(sqrtm(R_22))
eigens_f <- eigen(rrRrr_f)

can_cors <- sqrt(eigens_e$values)

CCP::p.asym(rho = sqrt(eigens_e$values), N = n, p = p, q = q, tstat = "Wilks")
```

Equation 10-38 on page 563
```{r}
n * log(det(R_11) * det(R_22) / det(R))
-n * log((1-can_cors[1]^2) * (1-can_cors[2]^2))
-(n - 1 - 1/2*(p + q + 1)) * log((1-can_cors[1]^2) * (1-can_cors[2]^2))

chi_df1 = p * q
qchisq(p = .05, df = chi_df1, lower.tail=FALSE)

```

### b)

```{r}
U_a1 <- t(eigens_e$vectors[,1]) %*% solve(sqrtm(R_11))
U_a1 # plus all the p X1s
V_a1 <- t(eigens_f$vectors[,1]) %*% solve(sqrtm(R_22))
V_a1 # plus all the q X2s
```

### c)

```{r}
# Correlation between canonical covariates and X1s
U_corr_X1 <- U_a1 %*% R_11
V_corr_X1 <- V_a1 %*% R_21
UV_X1 <- rbind(U_corr_X1, V_corr_X1)
rownames(UV_X1) <- c("U correlation with", "V correlation with")
colnames(UV_X1) <- c("x1", "x2")
UV_X1

# Correlation between canonical covariates and its X2s
U_a1 %*% R_12
V_a1 %*% R_22
```

### d)

From the solutions manual, U1 is about family entertainment outside (the home) and V1 is about socioeconomic status. Since everything is correlated in the same direction, we interpret that as "they go hand in hand" 


### e)

```{r}
U_a2 <- t(eigens_e$vectors[,2]) %*% solve(sqrtm(R_11))
UA <- rbind(U_a1, U_a2)
UA
UA_inv <-solve(UA)
a1_hat <- UA_inv[,1]
a2_hat <- UA_inv[,2]
# proportion of variance explained by U1
sum(diag(t(a1_hat) %*% a1_hat)) / 2
# proportion of variance explained by U2
sum(diag(t(a2_hat) %*% a2_hat)) / 2

V_a2 <- t(eigens_f$vectors[,2]) %*% solve(sqrtm(R_22))
V_a3 <- t(eigens_f$vectors[,3]) %*% solve(sqrtm(R_22))
B <- rbind(V_a1, V_a2, V_a3)
B_inv <- solve(B)
b1_hat <- B_inv[,1]
b2_hat <- B_inv[,2]
# proportion of variance explained by V1
sum(diag(t(b1_hat) %*% b1_hat)) / 3
# proportion of variance explained by V2
sum(diag(t(b2_hat) %*% b2_hat)) / 3
```


## 10.18

```{r}
t7.7 <- read.csv("https://sites.ualberta.ca/~dwiens/stat575/datasets/T7-7.DAT",
                  sep = "", header = FALSE)
colnames(t7.7) <- c("x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8")
```

```{r}
R <- cor(t7.7)
R11 <- R[1:4, 1:4]
R12 <- R[1:4, 5:8]
R21 <- R[5:8, 1:4]
R22 <- R[5:8, 5:8]

rrRrr_e <- solve(sqrtm(R11)) %*% R12 %*% solve(R22) %*% R21 %*% solve(sqrtm(R11))
eigens_e <- eigen(rrRrr_e)
rrRrr_f <- solve(sqrtm(R22)) %*% R21 %*% solve(R11) %*% R12 %*% solve(sqrtm(R22))
eigens_f <- eigen(rrRrr_f)

can_cors <- sqrt(eigens_e$values)
can_cors
```



Prop of sample variance explained for U1
```{r}
a1 <- t(eigens_e$vectors[,1]) %*% solve(sqrtm(R11))
a1
A <- t(eigens_e$vectors) %*% solve(sqrtm(R11))
A

A_inv <- solve(A)
a1_hat <- A_inv[,1]
a2_hat <- A_inv[,2]
a3_hat <- A_inv[,3]
a4_hat <- A_inv[,4]

p <- 4
# U1-4 explained sample variance
sum(diag(t(a1_hat) %*% a1_hat)) / p
sum(diag(t(a2_hat) %*% a2_hat)) / p
sum(diag(t(a3_hat) %*% a3_hat)) / p
sum(diag(t(a4_hat) %*% a4_hat)) / p


```

U_i corr X1
```{r}
A[1,] %*% R11

U_X1_corr <- A %*% R11
rownames(U_X1_corr) <- c("U1", "U2", "U3", "U4")
U_X1_corr
```


Prop of sample variance explained for V1
```{r}
b1 <- t(eigens_f$vectors[,1]) %*% solve(sqrtm(R22))
b1
B <- t(eigens_f$vectors) %*% solve(sqrtm(R22))
B
B_inv <- solve(B)
b1_hat <- B_inv[,1]
b2_hat <- B_inv[,2]
b3_hat <- B_inv[,3]
b4_hat <- B_inv[,4]

q <- 4
# Proportion of variance explained by V1-4
sum(diag(t(b1_hat) %*% b1_hat)) / q 
sum(diag(t(b2_hat) %*% b2_hat)) / q
sum(diag(t(b3_hat) %*% b3_hat)) / q
sum(diag(t(b4_hat) %*% b4_hat)) / q
# should sum to 1
```

V_i corr X1
```{r}
B[1,] %*% R22

V_X2_corr <- A %*% R22
rownames(V_X2_corr) <- c("V1", "V2", "V3", "V4")
V_X2_corr
```

MORE BECAUSE WE CAN

```{r}
U_X2_corr <- A %*% R12
U_X2_corr
V_X1_corr <- B %*% R21
V_X1_corr
```

Significance
```{r}
n <- nrow(t7.7)
qchisq(p = .05, df = p*q, lower.tail = FALSE) # chi crit
-n * log((1-can_cors[1]^2) * (1-can_cors[2]^2) * (1-can_cors[3]^2) * (1-can_cors[4]^2))
-n * log((1-can_cors[2]^2) * (1-can_cors[3]^2) * (1-can_cors[4]^2))
-n * log((1-can_cors[3]^2) * (1-can_cors[4]^2)) # not significant


```










